<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Pa√≠ses mais pr√≥ximos</title>
  <link rel="manifest" href="manifest.json">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2c3e50">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f9f9f9;
      color: #333;
    }

    h1 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 20px;
    }

    #status {
      text-align: center;
      margin-bottom: 15px;
      font-size: 1rem;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0 auto;
      max-width: 600px;
    }

    li {
      margin: 10px 0;
      padding: 12px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: flex-start;
      transition: transform 0.2s;
    }

    li:hover {
      transform: scale(1.02);
    }

    img {
      width: 40px;
      height: auto;
      margin-right: 12px;
      border-radius: 4px;
      flex-shrink: 0;
    }

    /* Responsividade */
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }
      li {
        font-size: 0.95rem;
        padding: 10px;
      }
      img {
        width: 32px;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.4rem;
      }
      #status {
        font-size: 0.9rem;
      }
      li {
        flex-direction: column;
        align-items: flex-start;
      }
      img {
        margin: 0 0 8px 0;
        width: 50px;
      }
    }
  </style>
</head>
<body>
  <h1>üåç Pa√≠ses mais pr√≥ximos de voc√™</h1>
  <p id="status">Obtendo sua localiza√ß√£o...</p>
  <ul id="countries"></ul>

  <script>
    // F√≥rmula de Haversine
    function haversine(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const toRad = x => x * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    async function main(lat, lon) {
      try {
        document.getElementById("status").textContent = 
          `Sua localiza√ß√£o: ${lat.toFixed(4)}, ${lon.toFixed(4)}`;
        
        const res = await fetch("https://restcountries.com/v3.1/all");
        const countries = await res.json();

        const distances = countries.map(c => {
          if (!c.latlng) return null;
          const [clat, clon] = c.latlng;
          return {
            name: c.name.common,
            flag: c.flags?.png || "",
            distance: haversine(lat, lon, clat, clon).toFixed(0)
          };
        }).filter(Boolean);

        distances.sort((a, b) => a.distance - b.distance);

        const list = document.getElementById("countries");
        list.innerHTML = "";
        distances.slice(0, 10).forEach(c => {
          const li = document.createElement("li");
          li.innerHTML = `<img src="${c.flag}" alt="flag"> <span>${c.name} - ${c.distance} km</span>`;
          list.appendChild(li);
        });
      } catch (e) {
        document.getElementById("status").textContent = "Erro ao carregar: " + e;
      }
    }

    // Usando Geolocation do navegador
    if ("geolocation" in navigator) {
      navigator.geolocation.getCurrentPosition(
        pos => main(pos.coords.latitude, pos.coords.longitude),
        () => document.getElementById("status").textContent = "N√£o foi poss√≠vel obter sua localiza√ß√£o."
      );
    } else {
      document.getElementById("status").textContent = "Geolocaliza√ß√£o n√£o suportada no seu navegador.";
    }

    // Registrar service worker para PWA
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>
</body>
</html>
